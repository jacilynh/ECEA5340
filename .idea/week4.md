#Week 4#
1: Module 4 Introduction
Welcome to module four of course one. This week, we will learn about amplifiers. First the theory part, we will review the ideal op amp and its characteristics. Then, we will show how to build different types of amplifiers with resistive networks, inverting, non inverting, summing, differential, and instrumentation amplifiers. We will go over the gain equations, too. Okay people, show of hands, who learned it in college and has completely forgotten? Now I should see hundreds of thousands of hands. This is a MOOC, you know? And I do see all those hands, good. Well, you're just like the people I teach on campus. They learn stuff, next semester, forget everything, and then they gotta start all over. [SOUND] I will help you. Now, we will have a couple of videos to explain amplifier imperfections. This way you will know how to interpret amplifier parameters on a manufacturer's spec sheet. We will also teach you about sensor noise, how to interpret the various kinds of noise, how it affects sensor accuracy, and how to attenuate it. You will find this skill is critical to designing a superior sensor system.

2: Why Study Amplification?
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

Remember learning about amplifiers in your classes on analog electronics? You probably wondered back then why you needed to study it. So nobody explained it back then, please give me a chance to explain it now. Recall from module one that the tables for thermocouple voltage outputs had small signals on the order of 5 to 20 millivolts and they were nonlinear too. All sensor systems have complex analog front end circuitry to deal with the low amplitude and also the nonlinearity of the signals. The filtering of sensor signals in front of the ADC is more difficult than the digital control for the sensored actuator.

Achieving high accuracy, low noise, and low drift are all major challenges in sensor system design. And solving these problems comes back to amplification.

Let's discuss which sensors need amplification. Process sensors are used in the petrochemical, pharmaceutical, and semiconductor industries to measure and control.

Wait a minute, wait a minute, this stuff sounds too familiar?

Wasn't this my opening slide for the course? Yeah, yeah, that's right. It was. Okay, let's simplify this. All sensors need amplification, which is how the next videos after this one became part of this course.

You may recall the assumptions behind the ideal amplifier. They are unusually ideal even for the academic world. We'll give you examples in the upcoming videos that illustrate the differences between ideal and real amplifiers. Here's a quick summary of the differences. Open loop gains are not infinite, and running an op amp in a closed loop configuration reduces its gain to a practical level.

Inputting pins is not infinite so small currents do flow through the amplifier input ports. If inputs are equal in an ideal op amp, you get zero output. But in real op amp, making the input exactly equal puts the output into saturation. An offset voltage is needed to get the output back to zero.

The output does not change instantaneously when the input changes, and ramps up at the slew rate to its new level which means that your amplifier will have a delay of 5 to 10 microseconds before the output fully responds. And last, ideal op amps have infinite bandwidth, the best ones on the market though have cutoff frequencies 10 ten kilohertz up to 1megahertz depending on the intended gain.

So let's recap, we've explained why gaining expertise on amplifiers is necessary to master the field of sensors. Now we will take a deep dive inside the design and specs of amplifiers.


3: Basic Amplifiers
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

Let's go over the time-honored configurations of amplifiers. We'll start with the open loop configuration shown here, and then work through the closed loop ones.

An op amp has two high impedance inputs, the inverting one marked V1 and the non-inverting one marked V2. The input impedances are very high, but not infinite as in the ideal op amp. The output V0 has very low impedance, but not 0 as in the ideal op amp. The output voltage is equal to the gain times the difference between the input voltages, an important feature used in all close loop configurations. And of course, an external supply voltage is needed to power the amplifier.

When an amplifier is used with resistor and capacitor networks between its output and input terminals, unique types of operational features result. Hence the name, operational amplifier.

This one is called an inverting amplifier. To study the circuit analytically, we must assume that current cannot flow into the input terminals. The non-inverting input is tied to ground, and because current does not flow into the input terminals, the inverting input must be at the same potential, which we call a virtual Earth. This makes it easy to solve for Vout in terms of Vin, and obtain a formula for the gain. Using Ohm's Law, we see that i equals Vin over R1 and -i equals Vout over R2. Note the sign change in i for the second formula, because the current is flowing in the opposite direction.

The gain is easily calculated as -R2 over R1. Note that the output gets inverted, hence the name inverting amplifier. To get a different gain, you just vary the ratio of the resistors.

This next one is the non-inverting amplifier. We assume that current cannot flow into the input terminals. That puts both input terminals at potential V1, but this time only resistor R1 is tied to ground.

Again, using Ohm's law, we see that i equals Vin divided by R1 and i also equals Vout divided by R1 + R2. No sign change for i this time. Doing the algebra, the gain is Vout over Vin equals 1 + R2 divided by R1. To get a different gain, you again vary the ratio of the resistors.

The summing amplifier gets its name, because it operates as the sum of a series of inverting amplifiers. Same core assumptions as for the inverting amplifier.

We use the principle of super position to calculate the gain. This means that we calculate the component of Vout from each of the inputs and then sum them up algebraically. Using Ohm's law, we calculate the gain for input V1 in the same manner as for the inverting amplifier. Then Vout over V1 equals -R2 over R1, then you use the same formula to find the gain for the other inputs. You sum up the individual gains algebraically to get this last formula. Using standard values of resistors, you have the flexibility to get enormous variety of gains, much more than if you only had one voltage input. The inverting, non-inverting, and summing amplifiers applied only one external voltage to the inputs.

The differential amplifier applies external voltage to both inputs, making it useful for amplifying sensor signals.

We use the principle of super position to calculate the gain, similarly to what we did for the summing amplifier.

First, we use the formula for summing divider to find V+ in terms of V1.

Ignore V2 for now, note the flow of current i per the arrows on the slide. Current flows to ground from V+ through resistor R2 and from V1 through resistors R1 and R2. Then V+ equals R2 divided by R1 + R2, all of that times V1. Now we have to calculate the component of Vout from V1. We can view the system as a non-inverting amplifier with current through R3 and R4 flowing to ground. We use the method for non-inverting amplifiers to calculate Vout in terms of V1.

We use Ohm's Law and equate the formula for the current flow. Then, we substitute the equation previously obtained for V+ into the equation for Vout in terms of V1. Doing the algebra, we see that V1out = V1 times R2 over R1 over R2 times R4 + R3/R3. Next, we calculate the component of Vout directly from V2. We view the system as an inverting amplifier with current through R3 and R4 flowing to ground.

With V1 added the system now and assumed to be a ground point, V+ is tied to ground, because current does not flow into the input terminals V- must be at the same potential as V+, and thus V- is a virtual earth.

We use Ohm's Law and equate the formulae for the current flow. V2 equals iR3 and V2out equals minus iR4. Then we do the algebra, and we see that V2out equals minus V2 times R4 divided by R3.

Last major step.

We use the principle of superposition and add the components of Vout uniquely due to V1 and V2. Vout equals V1out + V2out. We have a sadly complex formula for Vout in terms of V1, V2, R2, R1, R3, and R4. It's so sad, very, very sad.

Where was I?

Yes, we need what is known in the trade as a simplifying assumption if we're going to get out of this one.

Here's your simplifying assumption, because you are the amplifier designer, you're allowed to let R3 equal R1, and R2 equals R4. So we make the substitutions in our complex formula and do some more algebra. Mercifully, the term R4 + R3 divided by R3 lives on in both the numerator and the denominator as a factor multiplying V1, and thus it cancels out.

So you get a simpler formula where the factor R4 over R3 is a common multiplicative factor for both V1 and V2.

The output of the differential amplifier is directly proportional to the difference of the two external voltages V1 and V2, where the gain is given by R4 divided by R3. Hence the name, differential amplifier.

Thermocouple sensor signals have very small differential voltages on the order of five to 20 millivolts across the leads of the voltmeter measuring them. You need to run those leads through some form of differential amplifier first before attempting to get an accurate thermocouple reading.

Let's recap. We just covered inverting, non-inverting, summing and differential amplifiers. Now you're going to learn how an instrumentation amplifier works. This amplifier is a special form of differential amplifiers used in many sensor circuits including thermocouples. We will go through an instrumentation amplifier spec sheet and teach you how to apply the specs to your sensor circuit.
(Required)

4: Instrumentation Amplifier
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

Instrumentation amplifier is a form of a differential amplifier where the inputs are buffered by two op amps. It is designed specifically for sensor inputs with its variable high gain, high input impedance, low input offset drift, and high common mode rejection. It is commonly used to amplify small differential signals for thermocouples, strain gauges and current sensors used in motor control. The pinouts are specifically set up for amplifying sensor signals. We'll go over the pinouts a little later. Let's take a look at the high level design of an instrumentation amplifier. The inputs, V1 and V2, are fed into two operational amplifiers. The resistance network of R1 and R2 will make them perform as two inverting amplifiers. The output of these buffering amplifiers is fed into a differential amplifier. V_out is the amplified signal for V1 and V2. R1 is a variable gain resistor, sometimes called R_G in the spec sheets. You're given a formula in the spec sheets that tells you what resistor value to use for R_G to give you a certain gain. The gain varies from 1 to 1,000 on commercial instrumentation amplifiers. Let's calculate the gain equation for an instrumentation amplifier. We use the principle again of superposition to calculate the gain similarly to what we did for the summing in differential amplifiers. First, we will calculate the component of V_out directly from V1. We set V2 to zero and we take amplifier, A2, out of the system. Amplifier, A3, acts as a differential amplifier, with input voltages, V3 and V4, and the resistor network of R3 and R4. V_out1=R4 over R3 times V4-V3. First, we solve for V3 in terms of V1. With amplifier, A2, out of the system and V2 assumed to be a ground point, V2+ is tied to ground. Because current does not flow into the input terminals. V2- must be at the same potential as V2+, and thus, V_b is a virtual earth. A1 acts as a non-inverting amplifier with current through R1 and R2. We use the formula for non-inverting amplifiers to calculate V3 in terms of V1. Then V3=V1 times 1+R2 over R1. We still have V4 as an unknown in terms of V1. However, we can find V4 in terms of V3 and do an algebraic substitution later. The current flows are shown with the letter I. There is nowhere else for current to flow. The inputs to an op amp are of infinite impedance, so current cannot flow into the negative lead of amplifier, A1. Amplifier, A2, is out of the system, so current, I, cannot flow there. This forces voltage, V4, to go below earth ground level making it negative. Using Ohm's law to equate current, I, we find that V3 over R1+R2=-V_R over R2. Then VR=-V3 times R2 over R2+R1. And now, we have a way to substitute for V4 and V3 in the equation for V_out1 in step 1(a). Time for some algebra. This slide shows all the algebra to find V_out1 in terms of resistor values in V1. Let's bring back our formula from two slides ago, V_out1=R4 over R3 times V4-V3. Then we substitute in the value for V3 calculated two slides ago and the value for V4 calculated in the last slide. We get a complex formula in terms of V1 and all four resistor values. Fortunately, the term R1+R2 appears in the numerator/denominator part of this formula and cancels out. Combining terms, we are left with V_out1=-V1 times R4 over R3 times R1+2R2 over R1. Now, we need a formula for V_out2, the component of V_out coming from input voltage V2. This is a symmetric calculation, so we're mostly going to breeze through it. However, the next slide document the detailed calculation which you can verify on your own. This time, we take amplifier, A1, out of the system. We set V1 to zero and calculate the component of V_out from V2. Amplifier, A3, is again a differential amplifier, but this time, with input voltages of V5 and V6. Now, V_out2 depends on the difference between V5 and V6. First, we solve for V5 in terms of V2. V_a this time becomes the virtual earth, A2 is the non-inverting amplifier, and V5=V2 over 1+R2 over R1. Continuing with finding V_out2 this time, we find V6 in terms of V5. The current flows are shown with the letter I. Again, using Ohm's law, V5 over R1+R2=-V6 over R2. Then V6=-V5 times R2 over R2+R1. And now, we can substitute for V6 and V5 in the equation for V_out2 in step 2(a). More of the same type of algebra as before, we find V_out2 in terms of resistor values in V2. We bring back the formula for V_out2 and then we substitute in the values for V5 and V6. The term R1+R2 cancels out, simplifying the terms. We combine them and get an equation for V_out2. It's the same as V_out1 except that there is no negative sign. By using superposition, we find V_out as the sum of V_out1 and V_out2. The instrumentation amplifier is still a differential amplifier because it depends on the difference between V1 and V2. The resulting equation shows a gain term that depends on all four resistor values. The circuit designer adjusts R1 to get a desired gain, with the resulting gain determined from the formula R4 over R3 times R1+2R2 divided by R1. Let's look at the AD8422 instrumentation amplifier. In this chip, R1 is called R_G, which the designer adjusts in the circuit to get gains between 1 and 1,000. The chip has a high common mode rejection ratio which allows it to keep noise signals common to V1 and V2 from showing up in V_out. The input offset voltage multiplies with the gain to produce an error in the amplified signal, so the lower the spec, the higher accuracy sensor reading you will have. Low noise distortion is important for low voltage sensors signals. Let's correlate the pinouts to our circuit diagram. +IN is for the voltage that we had called V2. -IN is for the voltage we had called V1. These pinouts will be for the plus and minus leads from your sensor. You place a resistor, R1, across the two leads called R_G. +V_s is the positive supply voltage to the amplifier and -V_s is the negative supply voltage. V_out is your amplified signal, which was also called V_out in our circuit diagrams. You can level shift up the output voltage by connecting V_REF. The definition table for the pinouts shows you the formula for the gain. In this circuit, R4 has been set equal to R3, and R2 has been set to 9.9 kilo ohms. Let's recap. Now you've learned how to use an instrumentation amplifier for low voltage sensors that need high amplification, such as thermocouples and string gauges. In the next video, we will explain some important specs found on amplifier spec sheets and how these specs affect your sensor accuracy.

5: Amplifier Imperfections
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

Our first deviation from the ideal op amp involves a spec called the input offset voltage. The ideal op amp output is zero when both inputs are at equal voltage. There's no such thing as an input offset voltage. But a real op amp will saturate when you have exactly equal inputs. The real op amp saturates when the inputs are equal. The voltage needed to get the op amp off the rails is the input offset voltage. See, this circuit on the right side of the slide is a model for input offset voltage in a non-inverting amplifier. The input offset voltage is in series with ground. That voltage restores the balance in the amplifier when inputs are identical. You want to buy an amplifier with a small offset voltage. The reason is that it gets multiplied by the gain to produce an error in the amplified signal. Sensors like thermocouples and strain gauges need very high gains to produce a measurable output. A high offset voltage will have a major effect on your sensor accuracy. The offset voltage has a base value at 25 degrees C and grows with temperature difference away from 25 C. Here's a comparison of specs from three amplifiers. The PSOC chip has a low base reading but drifts a great deal for temperatures far away from 25 C. It's a good thing you'll be using it in your labs near temperatures of 25 degrees C. The LM358 amp should not be used with thermocouples or string gauges. Its high input offset voltage will cause accuracy problems. The AD8422 is an instrumentation amp having a very small input offset voltage, by far, the best of the three amplifiers. Some spec sheets share the statistical data the manufacturers used to calculate input offset voltage. These statistical distribution show all the test data that the companies took to calculate input offset voltage. The specs given on the previous slide correspond to the worst case test samples taken. Roughly, it's three standard deviations away from the mean in the histograms shown. Let's study some of the amplified errors. 100x gain is typical for sensor signals. Your PSOC kit produces 50 millivolts of error which is okay for your own lab work. The 700 millivolt error from the LM358 chip would drown out your thermocouples signal. The AD8422 gives only six millivolts at 25 degrees, low enough to produce a very accurate digital thermometer in high volumes. Minimizing error due to input offset voltage is reason number one to buy an instrumentation amplifier for commercial sensors circuits. Our second deviation from the ideal op amp is called the input bias current. The ideal op amp draws zero current on its input terminals, but real ones leak tiny amounts of current across them. There is no clean way to model this current. The bias current happens because real op amps have a large but still finite input impedance on their input terminals. These input terminals are connected to transistors inside the op amp. Note the circuit diagram illustrating input bias current. It shows up as a voltage drop across your input resistor network. The bigger your resistors, the more the voltage drop. Input bias currents are specified in microamps. Some circuit designers will try to compensate for input bias current. They add a resistor to the input terminal to equalize the voltage drop from input bias current on the other input terminal. This is usually only need an older bipolar amplifier designs. You want to buy an amplifier with a small input bias current. And here's some typical values. PSOC kit does not specify one. Sorry, the LM741 has one and a half microamps of input bias current. LM358 has 0.5 microamps. The instrumentation amplifier AD8422 has the best spec of point 0.0005 microamps of input bias current. Let's study the voltage errors with a 10 kiloohm input resistor. No way to calculate an error for the PSOC kit. The input bias current was not specified. The LM741 chip produces a 15 millivolt error. The LM358 chip has a five millivolt error. The instrumentation amplifier AD8422 has negligible error of 0.005 millivolts. So minimizing error due to input bias current is reason number two to buy an instrumentation amplifier for sensor. Our third deviation from the ideal op amp is called common mode rejection. The output of the ideal op amp should not change if identical, in-phase input signals, in other words, common mode signals are applied. But in real op amps, the change in output consists of a large differential gain for the intended measured voltages plus a very small common mode gain. A spec called the common-mode rejection ratio. CMRR measures the ability of a differential amplifier to reject the common-mode signals as opposed to amplify them. Like a low pass filter, CMRR is flat from DC up to a cutoff frequency and then gets steadily worse as frequency increases. Let's go over the formula for common mode rejection per the circuit diagram shown. The formula for the differential gain V_out is the same one we have been using, V_out equals A_ol times V_2 minus V_1. A common mode gain is given by the average of the gains from the two input terminals. V_cm which is one half A_cm times V_2 plus V_1. The common mode rejection ratio is the differential mode gain divided by the common mode gain shown on the spec sheets in decibels. CMRR then equals 20 log of base 10 A_ol divided by A_cm. Let's discuss the errors introduced due to a lack of common mode rejection. RF noise appears as an offset on both wire leads of the sensor, making that noise a common-mode signal. Given that sensor wires get strong throughout large factories inducing RF noise on the lead wires is a common occurrence. The CMRR determines the attenuation applied to the RF noise. The larger the CMRR, the more your amplifier will output the differential signal you want and the less it will amplify the RF noise. The LM358 chips specifies CMRR has 80 decibels at 25 degrees C. There's no mention of frequency dependency. So you can assume it's going to get a lot worse at high frequencies. The spec sheets for amplifiers OP177 and AD8422 show a frequency dependency. The OP177 is not a variable gain device so it shows only one curve. The CMRR drops off quickly after only 10 hertz. You will not want to use this device for high frequency amplification. The AD8422 is a variable gain device. The manufacturer chose to specify the CMRR at gains of one, 10, 100, and the maximum of 1,000. The smaller the gain, the higher the cutoff frequency before CMRR reduces. However, the higher the gain, the higher the CMRR to begin with. Minimizing error due to poor common mode rejection is reason number three to buy an instrumentation amplifier for sensors. Let's recap. You've learned how to interpret three important specs for amplifiers: input offset voltage; input bias current, and common mode rejection. In the next video, you will learn about open loop frequency response and slew rate.

6: Amplifier Frequency Response
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

So far we've discussed frequency response of an op amp for various deviations from the ideal op amp. Now, we will talk about the frequency response of the gain itself. Real op amps do not have infinite bandwidth for the gain. An open loop gain is defined as the output amplification with no external feedback signals connected. Take a look at this graph. The gain will be roughly flat from DC to the minus 3 dB point, where the output is attenuated three decibels.

Then, it drops off fairly linearly as frequency increases. The gain bandwidth product is the defined as the product of gain and bandwidth. If the frequency drop off is exactly linear, the gain bandwidth will be constant along the line.

Shown in this graph is the frequency dependency of the AD8422 instrumentation amplifier. The curves are similar to that shown for CMRR. The AD8422 is a variable gain device. The manufacturer chose to specify the frequency dependency of the gain for gains of 1, 10, 100, and the maximum of 1,000. The gain of 1 is 0dB. A gain of 10 is 20dB. A gain of 100 is 40dB. And a gain of 1,000 is 60dB. The smaller the gain, the higher the frequency will be before you hit the minus 3 dB point. Some amplifier designers implement frequency compensation. This is done to make sure the op amp does not produce random oscillations at high frequencies. Stray capacitances, often between closely laid traces, can cause phase shifts at frequencies greater than 1 MHz. A high pass filter is substituted for one of the internal amplifier stages. This will reduce potential oscillations, but a side effect is that the open loop gain is also reduced.

The slew rate of an amplifier is analogous to the velocity of an automobile.

It is defined as the rate of change of the output voltage per unit time based on a step change in the input. It's akin to stepping down fully on the accelerator in an automobile to see how fast the car will go.

Slew rate is measured in volts per microsecond. And slew rate is influenced by the amount of frequency compensation the amplifier designer chooses.

The same capacitors that help with frequency compensation also reduce the slew rate.

The LM358 spec sheet shows how the manufacturer measured slew rate.

It is measured at a gain of 1. The RC circuit in the diagram allows you to measure a time constant for the amplifier, from which you can derive the slew rate spec.

The LM358 has a slew rate of 0.3 volts per microseconds.

If you try to run your circuit faster than the slew rate, you will distort the output signal as shown in this graph.

An op amp needs a minimum slew rate of 2pifV0 to amplify an input signal of V0sin (2 pi ft) without distortion. This results from taking the first derivative of the signal V0sin (2 pi ft) and setting it to 0. The maximum slope of the curve occurs at the zero crossing. The graph shows how the sine curve can easily turn into a triangular wave if your clock speed is set too fast. Let's recap. [SOUND] That's all folks. This wraps up our theoretical discussion on amplifiers. Hopefully, you learned enough to be dangerous.

Week 4 Online Articles #1
Handbook of Modern Sensors by Jacob Fraden, Fifth Edition. Springer Scence+Business Media, LLC ISBN 978-3-319-19302-1 for hardcover book.  ISBN 978-3-319-19303-8 for ebook. Purchase textbook from this web site:
www.springer.com/us/book/9783319193021
.

Note: The above book is strongly encouraged, but not required for our Coursera Specialization. However, CU Master's degree students are required to obtain this book for this class.

Pages to read for this module:
Chapter 6 pages 193-201 6.1 Signal Conditioners - 6.1.4 Voltage Follower

The Evolution of the Instrumentation Amplifier, by Greg Davis of Microchip Inc. (Download from web site via this link):  
www.electronicdesign.com/analog/evolution-instrumentation-amplifier-pdf-download

Operational Amplifiers by Electronics Tutorials  (Download from web site via this link):
www.electronics-tutorials.ws/opamp/opamp_1.html

How to Derive the Instrumentation Amplifier Transfer Function by Adrian Nastase (Download from web site via this link):
www.masteringelectronicsdesign.com/how-to-derive-the-instrumentation-amplifier-transfer-function

MT-037 Tutorial on Op Amp Input Offset Voltage  (Download from Analog Devices web site via this link):
www.analog.com/media/en/training-seminars/tutorials/MT-037.pdf

MT-042 Tutorial on Op Amp Common-Mode Rejection Ratio (CMRR)   (Download from Analog Devices web site via this link):
www.analog.com/media/en/training-seminars/tutorials/MT-042.pdf

LM358 Dual Operational Amplifiers spec sheet  (Download from Texas Instrument web site via this link):
www.ti.com/product/lm358

AD8422 High Performance, Low Power, Rail-to-Rail Precision Instrumentation Amplifier spec sheet  (Download from Analog Devices web site via this link):
www.analog.com/en/products/amplifiers/instrumentation-amplifiers/ad8422.html#product-overview

OP177 Ultraprecision Operational  Amplifier spec sheet  (Download from Analog Devices web site via this link):
www.analog.com/media/en/technical-documentation/data-sheets/OP177.pdf

7: Noise in Sensors
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

We're going to start this video with the definition of noise as it relates to sensors. Now let's get this straight. It doesn't mean noise is the sound of cars honking their horns in a traffic jam or the sounds at a construction site. Noise is not someone else's loud music that you can't stand and it's definitely not your mother telling you, "Get out of bed. You got to get to school." Now, we will define sensor noise as the random edition of meaningless data added to your sensor signal. In simpler terms, it's all of those squiggles added to a sine wave that you see when you zoom in with the oscilloscope. We define sensor noise as stemming from sources inside your circuit with amplifiers and ADCs being amongst the usual suspects. This contrasts with interference which comes from sources external to your circuit. High-voltage power lines, enlarged electric motors are typical sources of electrical interference. Your sensor signal may look the same whether it's affected by noise or interference, but the solution to cleaning up that signal is very different for noise and interference. Noise is typically expressed as the signal to noise ratio, SNR for short. SNR is defined as 20 times the logarithm of the voltage of the signal divided by the voltage of the noise. This slide shows a quick test with the PSoC system to pinpoint the source of noise. In this case, a 10 kilohertz sine wave was fed into an LM741 op amp and the amplifier of the PSoC system. The PSoC chip amplified the sine wave flawlessly, producing the output you see in yellow. The LM741 op amp, however, badly distorted the sine wave. This op amp clipped the peaks of the sine wave as you see in the light blue curve. You would not want to use it if you thought your sensor would output a 10 kilohertz signal. The noise contribution of op amps is expressed as the standard normal distribution with a mean and a variance. As seen in the previous slide, op amps contribute their own noise to your sensor system. The mean value of the noise is zero while the variance is expressed by the formula, one over t times the integral of t v_n t squared, which is certainly not zero. V_n of t is the voltage level of the noise. Noise in a circuit depends on bandwidth. So let's back up a step and review the original engineering definition of bandwidth. I say original because these days people routinely use bandwidth to characterize an Internet connection, as in "Oh my God! This bandwidth is so lousy that it's taken me forever to access this video from YouTube." In analog terms, bandwidth is the range of frequencies, low to high, that a signal uses in a transmission device. The higher the gain, the lower the bandwidth. That can be seen in the graph in the slide. The open loop bandwidth in this circuit is 600 kilohertz. The frequency that the gain goes to zero. To find the close loop gain at 40 dB's, draw a straight line at the 40 dB line until it intersects the gain curve. Move vertically down until you intersect the x axis. The closed loop bandwidth is only eight kilohertz, the value of x at that point. Because noise in an op amp is related to bandwidth, you never want more bandwidth in a system than you need to get the sensor signal amplified. The graph on the right shows a plot of one over f noise, affectionately known as pink noise. The corner frequency is only 0.7 hertz. So for frequencies above that, you will pass only 10 nano volts of noise per hertz into your sensor system. Let's recap. We define noise for you in this video. Next up, we will describe the four most common types of noise; Johnson Nyquist, one over f, shot and quantization.
(Required)
en
​
8: Johnson and 1/f Noise
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

Let's start with Johnson-Nyquist noise, sometimes called Johnson noise or thermal noise. John Johnson was a research engineer at Bell Labs almost a century ago who discovered that electronic noise could be generated by the thermal agitation of charge carriers inside an electrical conductor at equilibrium. This could occur regardless of applied voltage or current flow in the conductor. His colleague, Harry Nyquist, confirmed the results and experiments. Nyquist, if you recall, created the Nyquist criterion which says that if you want to sample a signal and resolve all of its frequencies into components, you have to sample it at double the highest frequency it contains. Johnson-Nyquist noise can be modeled as white noise. Meaning its power density is the same at all frequencies. So the higher our bandwidth, the more Johnson-Nyquist noise you will let into your sensor system.

Johnson-Nyquist noise can be modeled as a noisy voltage source in series with a noiseless resistor. The variance of the noise is equal to four times k_B times times T times r per hertz of bandwidth, where k_B is Boltzmann's constant, 1.38 times 10 to the negative 23 joules per degree K, T is the absolute resister temperature in degrees K, and R is resistance in ohms. Electrical resistance increases with temperature and so does Johnson noise. Let's do a sample noise calculation. Suppose R equals 10,000 ohms at room temperature in a circuit with one megahertz bandwidth then V sub n squared equals 1.62 times ten to the negative 16th ohm-joule per hertz, and VN equals 12.72 to nano volts per square root of hertz. Now this is admittedly an odd unit of measurement. The noise is inversely proportional to the square root of the bandwidth. By using one megahertz of bandwidth, every 10 K resistor in your circuit will produce 12.7 micro volts of noise. If you have a lot of resistors and your signal is low, this noise may be appreciable. Maximum power transfer of this noise to the rest of your sensor circuit occurs when the Thevenin equivalent resistance of the rest of your circuit is equal to the resistance of the noisy resistor. Our odd unit of measure for Johnson noise is used by commercial Op Amp providers. The AD, A422 ARC Op Amp has a maximum of 80 nano volts per square root of hertz of output voltage noise. Peak to peak noise is tested in a frequency range and depends on the amplifier gain. In the worst case, this Op Amp has two micro volts of noise peak to peak at unitary game. One over f noise also known as pink noise, got its name from the fact that the power density is inversely proportional to frequency. In one over f noise, each octave carries an equal amount of energy. The name pink noise came about because the power spectrum looks pink when this type of noise occurs in visible light. Here's a fun fact for you. We humans do not hear different frequencies with equal sensitivity. Sounds at a couple of kilohertz sound the loudest. However, we can still hear the difference between white noise and pink noise. In electronic devices, one over f noise originates from slow changes in material properties of conducting metals, magnetic metals, and semiconductors. In this graph, one over f noise is significant under 1000 hertz which will be a problem if you have a sensor with low frequency response. The noise falls off at three decibels per octave, each doubling of frequency that is. Unfortunately both one over f noise and Johnson noise are alive and well in Op Amp. You need to take the sum squares of V sub n to find the total noise, which is the same technique used in calculating RMS voltage. The largest noise source always dominates the total noise. In this example, the Johnson noise is 80 nano volts per square root of hertz while the one-off noise is only a tenth of that at eight nano volts per square root of hertz. The total noise is close to 80 at 80.4 nano volts per square root of hertz. Let's recap. We discussed Johnson noise and one over f noise. Now let's go over shot and quantization noise.
(Required)

9: Shot and Quantization Noise
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

Shot noise, also called Schottky noise, occurs due to the random changes in the flow of discrete electrons in an otherwise constant DC current. It was named after Walter Schottky, who studied the fluctuations of current in vacuum tubes a century ago. This is the same guy who has a diode named after him, but he didn't fare as well when it came to noise. Let's think about this. They took his last name and they attached it to noise like it was some kind of nickname, something to the effect of, "Yo, Schott. Get over here. These circuits kind of noisy. Fix it." In any event, shot noise is inherently small due to the fact that fluctuations occur one electron at a time, is independent of temperature and frequency. The RMS of shot noise is expressed as a current flow. It is given by sigmas of i is the square root of two_q_I_delta_f, where q is the charge of an electron, which is 1.602 times 10 to the 19th coulombs. I is the DC current and delta_f is the bandwidth and Hertz. Let's calculate some shot noise. Suppose, I equals 100 milliamps, and delta_f is a thousand hertz. Then sigma_I is equal to the square root of two times q times I time delta_f, which comes out to only .006 microamps, a very small number. This comes out to only .000006% of your DC current, which kind of makes you wonder how Schottky discovered such small fluctuations with a low resolution equipment he had available a century ago. Let's compare shot noise to Johnson 1/f noise. Johnson-Nyquist noise decreases as temperature decreases while 1/f noise decreases as frequency increases. On the other hand, shot noise is temperature and frequency independent. When you put all this together with how RMS noise is calculated, you'll realize that shot noise can dominate only at very low device temperature combined with high frequency. So if you have an accelerometer measuring high frequency vibrations on the space shuttle somewhere out in distant space, the resulting signal will have a lot of shot noise in it. So let's look at quantization noise. This type of noise occurs during the conversion by an ADC of the analog sensor signal to a digital signal. An ADC performs sampling and quantization. Sampling converts the sensor signal into a string of real numbers. Quantization replaces each real number with a digital approximation of that number. Digitizing the sensor signal produces a string of errors, which are seen in the digital domain as noise. The graph shows how a sine wave is converted into a digitized signal by a four-bit ADC. The noise signal is shown in green. If you add it to the digital signal in black, you get back the original sine wave. The more digital levels the ADC uses, the lower the quantization noise you have. Quantization noise is modeled as an additive non-linear random signal. Digitizing a sawtooth or triangle wave gives us a good example of ideal quantization noise. The noise is uniformly distributed between plus or minus a half least significant bit. The signal to noise ratio is given by 20 log base 10 of two to the Q power, where Q is the number of bits in the ADC, for example, 8, 16 or 24. Solving this equation, the signal to noise ratio is 20 times the log base 10 of two times Q, which equals to 6.021 times Q. Sine wave quantization error is non-uniform so you have to add 1.761 dBs to the 6.021Q to get a good estimate of quantization noise. This slide has an example of quantization noise in a commercial ADC. The noise depends strongly on the sampling rate and depends only mildly on temperature. RMS noise goes up as the ADC conversion rate increases, which proves the old adage, you can have a job done quickly or you can have it done well, but you can't have a job done quickly and well at the same time. Let's recap. We discussed shot noise and quantization noise. Now, let's put it all together in a sensor circuit.

10: How Noise Affects Sensor Accuracy
Interactive Transcript - Enable basic transcript mode by pressing the escape key
You may navigate through the transcript using tab. To save a note for a section of text press ⌘ + S. To expand your selection you may use ⌘ + arrow key. You may contract your selection using shift + ⌘ + arrow key. For screen readers that are incompatible with using arrow keys for shortcuts, you can replace them with the H J K L keys. Some screen readers may require using ⌘ in conjunction with the alt key

As stated before, noise in a sensor circuit is additive via the RMS method. You will find Johnson and 1 over f noise in amplifies, Johnson noises resistance, a some amount of short noise when you have DC current in quantization noise in the ADC.

Noise will vary by temperature and frequency. It's best to consult the specs sheets for your components to identify potential sources of noise before you build a complex prototype.

Sensor noise hurts both the accuracy and resolution of your sensor system. Resolution is the smallest increment of signal change that a sensor can reliably detect. Accuracy on the other hand is defined as the error between the sensor reading and the quote true value of the reading. Of course you can never totally sense a physical quantity such as temperature because then you would need perfect accuracy.

The better the accuracy spec, however, the closer you will come. Both accuracy and resolution are inversely related to noise.

Sensor vendors use the RMS method of quoting accuracy because it is inversely related to noise in the sensor's signal. But sometimes they go over the top. I sometimes wonder if these guys took my course too seriously and decided to confuse their spec sheets with every source of error under the sun. This spec sheet quotes five independent sources of error when adding up the total accuracy budget of a type M transmitter. The error depends on the accuracy of the calibrated span, the ambient temperature, the static span effects, the static zero effects and the over pressure effects. They left out the tides and the phases of the moon. I don't even know how to begin to correlate these accuracies with noise. I suppose you don't really need to, if you're simply purchasing and using this sensor. Just remember though that you got some math to do if you want to truly understand how accurate your pressure reading will be.

The first step in reducing sensor noise is to realize that you cannot filter out hardware noise in the software without slowing down sensor response time. Generally speaking, you don't want to do that because customers have an expectation of how long it should really take to measure a physical quantity. And that isn't very long, so head immediately to stop two. Study your schematic and calculate relative orders of magnitude of sensor noise. Study the source impedances, and see which frequencies may be causing the noise you see in the prototype circuit. Then in step four, make sure to use an op amp that gives the least rms noise at the most common impedances.

Here's a good example of calculating noise in a commercial OP amp. In this example amplifier voltage noise dominates at zero source impedance. While at 3000 Ohms Johnson noise in input resistance, R is the largest source. But with R equal to 300,000 Ohms, shot or current noise in current flowing through resistor R is the highest source of noise. This makes sense as shot noise does tend to dominate at the higher frequencies.

Let's recap, we gave you some tips on how to assess sensor noise and reduce it. Now, go put these lessons to use in your sensor designs.
(Required)
en
​
Week 4 Online Articles
Handbook of Modern Sensors by Jacob Fraden, Fifth Edition. Springer Scence+Business Media, LLC ISBN 978-3-319-19302-1 for hardcover book.  ISBN 978-3-319-19303-8 for ebook. Purchase textbook from this web site:
www.springer.com/us/book/9783319193021
.

Note: The above book is strongly encouraged, but not required for our Coursera Specialization. However, CU Master's degree students are required to obtain this book for this class.

Pages to read for this module:
Chapter 6 pages 243-254 6.7 Noise in Sensors and Circuits - 6.7.3 Electric Shielding

Noise Measurement in Sensors Online magazine. Download from web via this link:
https://www.coursera.org/learn/sensors-circuit-interface/resources/isuUt

Op Amp Noise Application Note MT-47 (Download from Analog Devices web site via this link:
http://www.analog.com/media/en/training-seminars/tutorials/MT-047.pdf
